Private Sub 差压液位列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "差压变送器(液位)"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        On Error GoTo endd
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 6
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 13 Then
                GoTo jixu
                ElseIf n9 > 13 And n9 < 17 Then
                GoTo jixu
                ElseIf n9 > 21 And n9 < 25 Then
                GoTo jixu
                ElseIf n9 = 26 Then
                GoTo jixu
                 ElseIf n9 = 30 Then
                GoTo jixu
                ElseIf n9 > 34 And n9 < 39 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 18).Value = ActiveSheet.Cells(num7, 30).Text
                ll = ll + 1
                yl = yl + 7
                a2 = a2 + 1
                    If ll Mod 3 = 0 Then
                        j9 = j9 + 50
                        i = i + 50
                        yl = 14
                        num7 = num7 + 50
                    End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "设备位号", "介质", "压力", "温度", "量程", "精度", "输出信号", "测量元件材质", "防爆等级", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "差压变送器(液位)"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
End Sub
