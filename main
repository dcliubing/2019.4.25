Dim newname, shn, newname2 As String

Sub 工作簿生成()
        Application.ScreenUpdating = False
        
        If ActiveSheet.Cells(3, 11).Text <> "仪表数据表" And ActiveSheet.Cells(1, 4).Text <> "仪表数据表" Then
         MsgBox "确认是否为数据表表格"
         GoTo endd
          End If
        newname = ActiveWorkbook.Name
        newname2 = InputBox("请输入汇总表工作簿的名称：")
        On Error GoTo endd
        Dim iFile As String
        iFile = ThisWorkbook.Path & "\" & newname2 & ".xls"
        Workbooks.Add
        ActiveWorkbook.SaveAs iFile, True
        On Error GoTo endd
        Workbooks(newname).Activate
            For Each sh In Worksheets    '数组
            sh.Select
                If sh.Cells(4, 11).Value Like "*压力变送器*" Then
                    Call 压变列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*电磁流量计*" Then
                    Call 电磁列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*差压变送器*" Then
                    Call 差压液位列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*调节阀*" Then
                    Call 调节阀列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*切断阀*" Or sh.Cells(4, 11).Value Like "*开关阀*" Or sh.Cells(4, 11).Value Like "*开关阀*" Or sh.Cells(4, 11).Value Like "*切断阀*" Then
                    Call 开关阀列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*热电阻*" Then
                    Call 热电阻列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*双金属温度计*" Then
                    Call 双金属温度计列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*转子*" Then
                    Call 转子列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*涡街*" Or sh.Cells(4, 11).Value Like "*漩涡*" Or sh.Cells(4, 11).Value Like "*旋涡*" Then
                    Call 涡街列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*平衡*" Or sh.Cells(4, 11).Value Like "*节流*" Then
                    Call 平衡流量计列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*雷达*" Then
                    Call 雷达列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*音叉*" Then
                    Call 音叉列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*浮球*" Then
                    Call 浮球列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*温度变送器*" Then
                    Call 温变列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*压力表*" And InStr(sh.Cells(4, 11).Value, "隔膜") = 0 Then
                    Call 压力表列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*隔膜压力表*" Then
                    Call 隔膜压力表列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*静压*" Then
                    Call 投入式静压列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*pH/ORP*" Then
                    Call pHORP列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*磁氧*" Then
                    Call 磁氧列表
                    
                     ElseIf sh.Cells(4, 11).Value Like "*水分*" Then
                     Call 水分列表
                    
                     ElseIf sh.Cells(4, 11).Value Like "*红外线*" Then
                     Call 红外线列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*自力式*" Then
                    Call 自力式列表
                    
                     ElseIf sh.Cells(4, 11).Value Like "*压力开关*" Then
                     Call 压力开关列表
                    
                    ElseIf sh.Cells(4, 11).Value Like "*气体检测*" Then
                    Call 报警器列表
                    shn = ActiveSheet.Name
                End If
            Next
            
          
        Workbooks(newname2 & ".xls").Activate
        '工作表排序
       i% = Sheets.Count
       On Error Resume Next
           For Each tmp In Array("双金属温度计", "热电阻", "温变", "压力表", "隔膜压力表", "压变", "压力开关", "转子", "平衡流量计", "涡街", "电磁", "差压液位", "投入式静压", "雷达", "音叉", "浮球", "pHORP", "磁氧", "水分", "红外线", "调节阀", "开关阀", "自力式", "报警器") '工作表名
            t = Sheets(tmp).[a1]
            If Err = Empty Then Sheets(tmp).Move after:=Sheets(i) Else Err.Clear
            Next
          
        Call 表格汇总
        Application.ScreenUpdating = True
        MsgBox "新建工作薄," & vbCrLf & "完整路径及名称:" & vbCrLf & iFile
endd:
End Sub
Private Sub 压力表列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "压力表"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, tt, j10, ss, zz, fl, kh, kh2, fl2, dh, lh, lh2, num7, emp As Integer
        'Dim att As String
        Dim arr() As Variant
        yl = 2 '数据源列
        tt = 0
        j9 = 11  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        fl = 1  '新表列
        emp = 0
        dh = 0 '被删除行数
        num7 = 6
        j10 = 31
        j14 = 32
        j15 = 34
        j11 = 38
        j12 = 39
        j13 = 40
nei:
        Do
            If Application.WorksheetFunction.CountA(ActiveSheet.Rows(j9)) = 0 Then
                GoTo nei2
            End If
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 8).Value = ActiveSheet.Cells(j10, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 9).Value = ActiveSheet.Cells(j14, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 10).Value = ActiveSheet.Cells(j15, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 11).Value = ActiveSheet.Cells(j11, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 12).Value = ActiveSheet.Cells(j12, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 13).Value = ActiveSheet.Cells(j13, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 16).Value = ActiveSheet.Cells(num7, 30).Text
            a2 = a2 + 1
nei2:
            j9 = j9 + 1
            tt = tt + 1
        Loop Until tt Mod 15 = 0
        j15 = j15 + 50
        j14 = j14 + 50
        j13 = j13 + 50
        j12 = j12 + 50
        j11 = j11 + 50
        j10 = j10 + 50
        j9 = j9 + 35
        i = i + 50
        num7 = num7 + 50
        If Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0 Then
        Do
            yl = yl + 1
                If yl = 6 Or yl = 9 Or yl = 12 Or yl = 21 Or yl = 25 Then
                    j9 = 11
                    j10 = 31
                    j11 = 38
                    j12 = 39
                    j13 = 40
                    j14 = 32
                    j15 = 34
                    n9 = a2
                    fl = fl + 1
                    i = 3
                    num7 = 6
                    a2 = 2
                    GoTo nei
                End If
        Loop Until yl = 27
        Else: GoTo nei
        End If
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        ActiveSheet.Cells(a2, 1) = "总数量"
        arr = Array("位号", "介质", "温度", "压力", "量程", "PID号", "用途", "测量元件形式", "表头直径", "测量元件材质", "螺纹规格", "法兰标准及等级", "法兰尺寸及密封面", "数量", "仪表类型", "数据表页号")
        Range(Cells(2, 15), Cells(n9 - 1, 15)) = "就地压力表"
        Range(Cells(1, 1), Cells(1, 16)) = arr
        Range(Cells(1, 1), Cells(a2 - 1, 16)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 16)).Select
        Call 首行格式
        Workbooks(newname).Activate   'fan hui shu ju biao
        
        Erase arr
        
endd:
End Sub
Private Sub 转子列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "转子"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
        num7 = 6
nei:
            If n9 > 8 And n9 < 13 Then
                ElseIf n9 > 13 And n9 < 20 Then
                GoTo jixu
                ElseIf n9 > 22 And n9 < 35 Then
                GoTo jixu
                ElseIf n9 > 35 And n9 < 38 Then
                GoTo jixu
                ElseIf n9 = 43 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
        Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 26).Value = ActiveSheet.Cells(num7, 22).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
                If ll Mod 3 = 0 Then
                    j9 = j9 + 50
                    i = i + 50
                    yl = 10
                    num7 = num7 + 50
                End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "最大流量", "正常流量", "最小流量", "量程", "公称通径", "精度", "测量管材质", "浮子材质", "衬里材质", "工艺连接形式", "输出信号", "电源", "法兰标准", "法兰尺寸", "螺纹规格", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "转子流量计"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
        
        
endd:

Erase arr
End Sub

Private Sub 平衡流量计列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "平衡流量计"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2 As Integer
        Dim arr() As Variant
        num7 = 6
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 14 Then
                GoTo jixu
                ElseIf n9 > 14 And n9 < 21 Then
                GoTo jixu
                ElseIf n9 > 24 And n9 < 28 Then
                GoTo jixu
                ElseIf n9 > 28 And n9 < 31 Then
                GoTo jixu
                ElseIf n9 > 31 And n9 < 34 Then
                GoTo jixu
                ElseIf n9 > 35 And n9 < 39 Then
                GoTo jixu
                ElseIf n9 > 40 And n9 < 43 Then
                GoTo jixu
                ElseIf n9 = 47 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 25).Value = ActiveSheet.Cells(num7, 30).Text
                
                ll = ll + 1
                yl = yl + 7
                a2 = a2 + 1
                    If ll Mod 3 = 0 Then
                        j9 = j9 + 50
                        i = i + 50
                        yl = 14
                        num7 = num7 + 50
                    End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        yl = 14
        num7 = 6
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "介质", "压力", "温度", "最大流量", "正常流量", "最小流量", "量程", "结构形式", "公称通径", "传感器材质", "取压口形式", "法兰标准及等级", "法兰尺寸及密封面", "输出信号", "工艺连接形式", "测量元件材质", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "平衡流量计"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
        End Sub
        
Private Sub 电磁列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "电磁"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 6
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 8 And n9 < 13 Then
            ElseIf n9 > 13 And n9 < 20 Then
            GoTo jixu
            ElseIf n9 > 22 And n9 < 31 Then
            GoTo jixu
            ElseIf n9 > 32 And n9 < 36 Then
            GoTo jixu
            ElseIf n9 > 36 And n9 < 38 Then
            GoTo jixu
             ElseIf n9 > 38 And n9 < 41 Then
            GoTo jixu
            
            ElseIf n9 = 43 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 26).Value = ActiveSheet.Cells(num7, 30).Text
        ll = ll + 1
        yl = yl + 7
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 14
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "最大流量", "正常流量", "最小流量", "量程", "公称通径", "本体材质", "衬里材质", "电极材质", "法兰标准", "法兰尺寸", "接地环材质", "输出信号", "精度", "电源", "防爆等级", "安装形式", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "电磁流量计"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
End Sub

Private Sub 差压液位列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "差压液位"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        On Error GoTo endd
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 6
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 13 Then
                GoTo jixu
                ElseIf n9 > 13 And n9 < 17 Then
                GoTo jixu
                ElseIf n9 > 21 And n9 < 25 Then
                GoTo jixu
                ElseIf n9 = 26 Then
                GoTo jixu
                 ElseIf n9 = 30 Then
                GoTo jixu
                ElseIf n9 > 34 And n9 < 39 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 18).Value = ActiveSheet.Cells(num7, 30).Text
                ll = ll + 1
                yl = yl + 7
                a2 = a2 + 1
                    If ll Mod 3 = 0 Then
                        j9 = j9 + 50
                        i = i + 50
                        yl = 14
                        num7 = num7 + 50
                    End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "设备位号", "介质", "压力", "温度", "量程", "精度", "输出信号", "测量元件材质", "防爆等级", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "差压液位变送器"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
End Sub




Private Sub 压力开关列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "压力开关"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 6
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 13 Then
                GoTo jixu
                ElseIf n9 > 12 And n9 < 16 Then
                GoTo jixu
                ElseIf n9 = 20 Then
                GoTo jixu
                ElseIf n9 = 21 Then
                GoTo jixu
                  ElseIf n9 > 23 And n9 < 26 Then
                GoTo jixu
                ElseIf n9 = 30 Then
                GoTo jixu
                ElseIf n9 = 32 Then
                GoTo jixu
                ElseIf n9 > 33 And n9 < 38 Then
                GoTo jixu
               
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 19).Value = ActiveSheet.Cells(num7, 30).Text
            ll = ll + 1
            yl = yl + 7
            a2 = a2 + 1
                If ll Mod 3 = 0 Then
                    j9 = j9 + 50
                    i = i + 50
                    yl = 14
                    num7 = num7 + 50
                End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "测量元件材质", "量程", "工艺接头尺寸", "触点动作形式", "防爆等级", "安装形式", "法兰标准及等级", "法兰尺寸及密封面", "法兰材质", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "压力开关"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate
endd:
Erase arr
End Sub

Private Sub 自力式列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "自力式"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 7
        dh = 0 '被删除行数
nei:
            If n9 > 9 And n9 < 16 Then
                GoTo jixu
                ElseIf n9 > 16 And n9 < 20 Then
                GoTo jixu
                ElseIf n9 > 21 And n9 < 25 Then
                GoTo jixu
                ElseIf n9 > 30 And n9 < 32 Then
                GoTo jixu
                ElseIf n9 > 33 And n9 < 40 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 21).Value = ActiveSheet.Cells(num7, 22).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
                If ll Mod 3 = 0 Then
                    j9 = j9 + 50
                    i = i + 50
                    yl = 10
                    num7 = num7 + 50
                End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "管道规格", "介质", "温度", "压力", "最大流量", "正常流量", "最小流量", "阀型式", "公称通径", "阀体材质", "阀芯/阀座材质", "法兰标准及等级", "法兰尺寸及密封面", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "自力式调节阀"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate
endd:

Erase arr
End Sub

Private Sub 调节阀列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "调节阀"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6

            
        On Error GoTo endd
        Dim j9, n9, yl, i, a2, fl, kh, kh2, fl2, dh, lh, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 15 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        num7 = 6
        num34 = 33
        a2 = 2  '新表行
        fl = 1  '新表列
        emp = 0
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 15 Then
                GoTo jixu
                ElseIf n9 > 15 And n9 < 19 Then
                GoTo jixu
                  ElseIf n9 = 33 Then
                GoTo jixu
                ElseIf n9 = 35 Then
                GoTo jixu
                ElseIf n9 = 39 Then
                GoTo jixu
               
                ElseIf n9 > 42 And n9 < 46 Then
                GoTo jixu
                ElseIf n9 = 47 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 17).Value = ActiveSheet.Cells(num7, 30).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 11).Value = ActiveSheet.Cells(num34, 30).Text
            a2 = a2 + 1
            j9 = j9 + 50
            i = i + 50
            num7 = num7 + 50
            num34 = num34 + 50
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        num34 = 33
        yl = 15
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "管道规格", "介质", "温度", "压力", "防爆等级", "阀门形式", "阀座尺寸", "阀体材质", "阀芯材质", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "调节阀"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate
endd:

Erase arr
End Sub

Private Sub 开关阀列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "开关阀"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        
        
        
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
    Workbooks(newname2 & ".xls").Sheets(NewName6).Cells.Select
    Selection.NumberFormatLocal = "@"     '文本格式
      Workbooks(newname).Activate
      
      
      
      
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        num7 = 6
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        fl = 1  '新表列
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 15 Then
                GoTo jixu
                ElseIf n9 > 15 And n9 < 19 Then
                GoTo jixu
                ElseIf n9 > 22 And n9 < 27 Then
                GoTo jixu
                ElseIf n9 > 34 And n9 < 37 Then
                GoTo jixu
                ElseIf n9 > 41 And n9 < 44 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 19).Value = ActiveSheet.Cells(num7, 30).Text
                ll = ll + 1
                yl = yl + 7
                a2 = a2 + 1
                    If ll Mod 3 = 0 Then
                        j9 = j9 + 50
                        i = i + 50
                        yl = 14
                        num7 = num7 + 50
                    End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    '  MsgBox kh2
                    '  If Workbooks(newname2 & ".xls").Cells(kh2 - 1, 1) = "" Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "管道材质", "管道规格", "介质", "温度", "压力", "阀门形式", "公称通径", "阀体材质", "阀芯材质", "法兰标准及等级", "法兰尺寸及密封面", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "气动切断阀"
        'Range(Cells(2, fl + 1), Cells(lh, fl + 1)) = sjbyh
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate
endd:
Erase arr
End Sub

Private Sub 压变列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "压变"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 6
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 13 Then
                GoTo jixu
                ElseIf n9 > 13 And n9 < 17 Then
                GoTo jixu
               
                ElseIf n9 = 20 Then
                GoTo jixu
                ElseIf n9 = 22 Then
                GoTo jixu
                ElseIf n9 = 24 Then
                GoTo jixu
                ElseIf n9 = 28 Then
                GoTo jixu
                ElseIf n9 > 36 And n9 < 41 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 17).Value = ActiveSheet.Cells(num7, 30).Text
            ll = ll + 1
            yl = yl + 7
            a2 = a2 + 1
                If ll Mod 3 = 0 Then
                    j9 = j9 + 50
                    i = i + 50
                    yl = 14
                    num7 = num7 + 50
                End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "量程", "输出信号", "测量元件材质", "防爆等级", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "压力变送器"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate
endd:

Erase arr
End Sub


Private Sub 双金属温度计列表()
        'MsgBox newname
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "双金属温度计"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, tt, j10, ss, zz, fl, kh, kh2, fl2, dh, lh, lh2, emp, num7, sjbyh As Integer
        Dim arr() As Variant
        num7 = 6
        yl = 2 '数据源列
        tt = 0
        j9 = 11  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        fl = 1  '新表列
        emp = 0
        dh = 0 '被删除行数
        j11 = 38
        j12 = 39
        j13 = 40
nei:
        Do
            If Application.WorksheetFunction.CountA(ActiveSheet.Rows(j9)) = 0 Then
                GoTo nei2
            End If
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 9).Value = ActiveSheet.Cells(j11, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 10).Value = ActiveSheet.Cells(j12, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 11).Value = ActiveSheet.Cells(j13, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 14).Value = ActiveSheet.Cells(num7, 30).Text
            '    MsgBox ActiveSheet.Cells(num7, 22).Text
            '    sjbyh = ActiveSheet.Cells(num7, 22).Text
            '     MsgBox num7
            a2 = a2 + 1
nei2:
            j9 = j9 + 1
            tt = tt + 1
        Loop Until tt Mod 17 = 0
        j13 = j13 + 50
        j12 = j12 + 50
        j11 = j11 + 50
        num7 = num7 + 50
        j9 = j9 + 33
        i = i + 50
        If Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0 Then
            Do
                yl = yl + 1
                If yl = 6 Or yl = 9 Or yl = 12 Or yl = 19 Or yl = 23 Or yl = 27 Then
                    j9 = 11
                    j11 = 37
                    j12 = 38
                    j13 = 39
                    n9 = a2
                    fl = fl + 1
                    i = 3
                    num7 = 6
                    a2 = 2
                    GoTo nei
                End If
            Loop Until yl = 30
                    Else:
                    GoTo nei
        End If
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        ActiveSheet.Cells(a2, 1) = "总数量"
        arr = Array("位号", "介质", "压力", "温度", "量程", "保护管材料", "PID号", "用途", "螺纹规格", "法兰标准及等级", "法兰尺寸及密封面", "数量", "仪表类型", "数据表页号")
        Range(Cells(2, 13), Cells(n9 - 1, 13)) = "双金属温度计"
        'Range(Cells(2, 14), Cells(n9 - 1, 14)) = sjbyh
        Range(Cells(1, 1), Cells(1, 14)) = arr
        Range(Cells(1, 1), Cells(a2 - 1, 14)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 14)).Select
        Call 首行格式
        Workbooks(newname).Activate   'fan hui shu ju biao
endd:

Erase arr

End Sub

Private Sub 热电阻列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "热电阻"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, tt, j10, ss, zz, fl, kh, kh2, fl2, dh, lh, lh2, num7, emp As Integer
        'Dim att As String
        Dim arr() As Variant
        yl = 2 '数据源列
        tt = 0
        j9 = 11  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        fl = 1  '新表列
        emp = 0
        dh = 0 '被删除行数
        
         num7 = 6
        
        j10 = 29
               
        j11 = 37
        j12 = 38
        j13 = 39
nei:
        Do
            If Application.WorksheetFunction.CountA(ActiveSheet.Rows(j9)) = 0 Then
                GoTo nei2
            End If
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 8).Value = ActiveSheet.Cells(j10, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 9).Value = ActiveSheet.Cells(j11, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 10).Value = ActiveSheet.Cells(j12, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 11).Value = ActiveSheet.Cells(j13, 15).Text
             Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 15).Value = ActiveSheet.Cells(num7, 30).Text
            '          Sheets(NewName6).Cells(a2, fl).Value = Sheets(kvname).Cells(j9, yl).Text
            '         Sheets(NewName6).Cells(a2, 8).Value = Sheets(kvname).Cells(j10, 12).Text
            '
            '        Sheets(NewName6).Cells(a2, 9).Value = Sheets(kvname).Cells(j11, 12).Text
            '         Sheets(NewName6).Cells(a2, 10).Value = Sheets(kvname).Cells(j12, 12).Text
            '         Sheets(NewName6).Cells(a2, 11).Value = Sheets(kvname).Cells(j13, 12).Text
            a2 = a2 + 1
nei2:
            j9 = j9 + 1
            tt = tt + 1
        Loop Until tt Mod 14 = 0
        j13 = j13 + 50
        j12 = j12 + 50
        j11 = j11 + 50
        j10 = j10 + 50
        
        num7 = num7 + 50
        
        j9 = j9 + 36
        i = i + 50
        If Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0 Then
            Do
                yl = yl + 1
                If yl = 6 Or yl = 9 Or yl = 12 Or yl = 21 Or yl = 25 Then
                    j9 = 11
                    j10 = 31
                    j11 = 39
                    j12 = 40
                    j13 = 41
                    n9 = a2
                    fl = fl + 1
                    i = 3
                    a2 = 2
                     num7 = 6
                    GoTo nei
                End If
            Loop Until yl = 30
            Else: GoTo nei
        End If
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        ActiveSheet.Cells(a2, 1) = "总数量"
        arr = Array("位号", "介质", "压力", "温度", "保护管材料", "PID号", "用途", "分度号", "螺纹规格", "法兰标准及等级", "法兰尺寸及密封面", "数量", "量程", "仪表类型", "数据表页号")
        Range(Cells(2, 14), Cells(n9 - 1, 14)) = "热电阻"
        Range(Cells(1, 1), Cells(1, 15)) = arr
        Range(Cells(1, 1), Cells(a2 - 1, 15)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 15)).Select
        Call 首行格式
        Workbooks(newname).Activate   'fan hui shu ju biao
endd:

Erase arr
End Sub

Sub 数据表序号()
        ActiveWindow.View = xlPageBreakPreview
        Sheets(1).Select
        If ActiveSheet.Cells(1, 9).Text <> "仪表数据表" And ActiveSheet.Cells(1, 4).Text <> "仪表数据表" And ActiveSheet.Cells(1, 8).Text <> "仪表数据表" And ActiveSheet.Cells(1, 8).Text <> "仪表数据表" Then
                MsgBox "确认是否为首页"
                If ActiveWorkbook.Sheets.Count < 2 Then
                    GoTo endd
                End If
                Sheets(2).Select
            Else
                Sheets(1).Select
        End If
        If ActiveSheet.Cells(1, 9).Text = "仪表数据表" Or ActiveSheet.Cells(1, 4).Text = "仪表数据表" Or ActiveSheet.Cells(1, 8).Text = "仪表数据表" Then
            GoTo nee
            Else
                MsgBox "确认是否为数据表表格"
            GoTo endd
        End If
nee:
       On Error GoTo endd
        i = InputBox("输入开始页码") - 1
        'ms = MsgBox("是否考虑首页", vbOKCancel)
        'If ms = vbOK Then
        'i = 1
        'ElseIf ms = vbCancel Or ms = vbAbort Or ms = vbIgnore Then
        'i = 0
        'End If
        Application.ScreenUpdating = False
        Dim j, k, a2, fl, fy As Integer
        Dim x, y, syi As String
        ' i = 1
        a2 = 7
        x = "调节阀"
        y = "开关阀"
        syi = "索引"
        fl = 22
nei:
        If ActiveSheet.Cells(4, 4).Text = x Then
            fl = 13
            ElseIf ActiveSheet.Cells(4, 4).Text = y Then
            fl = 13
            ElseIf ActiveSheet.Cells(4, 8).Text = syi Then
            fl = 21
            Else: fl = 22
        End If
        Do
            i = i + 1
            ActiveSheet.Cells(a2, fl).Value = i
            fy = 1
            '      Set ActiveSheet.HPageBreaks(fy).Location = Rows(a2 + 44)
            a2 = a2 + 50
            fy = fy + 1
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(a2)) = 0
        a2 = 7
        fy = 1
pan1:
        If ActiveSheet.Index <> Worksheets.Count Then
            ActiveSheet.Next.Activate
            If ActiveSheet.Cells(1, 9).Text <> "仪表数据表" And ActiveSheet.Cells(1, 4).Text <> "仪表数据表" And ActiveSheet.Cells(1, 8).Text <> "仪表数据表" Then
                GoTo pan1
            End If
            GoTo nei
            Else
nei2:
            If ActiveSheet.Cells(4, 4).Text = x Then
                fl = 15
                ElseIf ActiveSheet.Cells(4, 4).Text = y Then
                fl = 15
                ElseIf ActiveSheet.Cells(4, 8).Text = syi Then
                fl = 24
                Else: fl = 25
            End If
            Do
                ActiveSheet.Cells(a2, fl).Value = i
                a2 = a2 + 50
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(a2)) = 0
            a2 = 7
pan2:
            If ActiveSheet.Index > 1 Then
                ActiveSheet.Previous.Activate
                    If ActiveSheet.Cells(1, 9).Text <> "仪表数据表" And ActiveSheet.Cells(1, 4).Text <> "仪表数据表" And ActiveSheet.Cells(1, 8).Text <> "仪表数据表" Then
                        GoTo pan2
                    End If
                GoTo nei2
            End If
        End If
        If ActiveSheet.Cells(1, 9).Text <> "仪表数据表" And ActiveSheet.Cells(1, 4).Text <> "仪表数据表" And ActiveSheet.Cells(1, 8).Text <> "仪表数据表" Then
            ActiveSheet.Cells(a2, fl).Value = ""    '首页页数清空
        End If
        Application.ScreenUpdating = True
endd:
End Sub
Sub IO点统计()


        Dim a, d, b, la, aon1, aon2, din1, din2, din3, don1, don2, rtdn, sjy As String
        Dim arr, arr2 As Variant
        Dim c, i, j, hang, lie, lie2, nn, sj, jj, ain, aon, din, don, iozs As Integer
        
        i = 0
        j = 2
        hang = 2
        lie = 1
        lie2 = 1
        ain = 0
        aon = 0
        aon1 = 0
        aon2 = 0
        din = 0
        din1 = 0
        din2 = 0
        din3 = 0
        don = 0
        don1 = 0
        don2 = 0
        rtdn = 0
        iozs = 0
jj = 1

Do

jj = jj + 1

         If Sheets("拆分汇总").Cells(jj, 8).Value Like "*变送器*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*流量计*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*分析仪*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*PH*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*ORP*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*电流反馈*" Then
         
          ain = ain + 1
          
       
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*热电阻*" Then
                  
          If Sheets("拆分汇总").Cells(jj, 9).Value Like "*ia*" Then
                                        
                                        
                                                ain = ain + 1
                                                
                                                Else
                                                         
                                                rtdn = rtdn + 1
         
                                        End If
         
         
         
         
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*开关阀*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*切断阀*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*电磁阀*" Then
          
         don1 = don1 + 1
        
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*远程启动*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*远程停止*" Then
           
         don2 = don2 + 1
         
        
        
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*阀位开反馈*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*阀位关反馈*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*开关*" Then
          
         din1 = din1 + 1
        
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*运行反馈*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*故障反馈*" Or Sheets("拆分汇总").Cells(jj, 8).Value Like "*停止反馈*" Then
          
         din2 = din2 + 1
         
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*按钮*" Then
          
         din3 = din3 + 1
        
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*调节阀*" Then
                
         aon1 = aon1 + 1
        
         ElseIf Sheets("拆分汇总").Cells(jj, 8).Value Like "*变频*" Then
                
         aon2 = aon2 + 1
                
          
          End If






Loop Until Application.WorksheetFunction.CountA(Sheets("拆分汇总").Rows(jj)) = 0



don = don1 + don2
aon = aon1 + aon2
din = din1 + din2 + din3
iozs = ain + aon + din + don + rtdn
          
          
 ' Dim iRow As Single, iCol As Single, MsgStr As String

 ' For iRow = 1 To 6

'  For iCol = 1 To 4

'  MsgStr = MsgStr & Cells(iRow, iCol) & vbTab

'  Next

'  MsgStr = MsgStr & vbCrLf

'  Next

'  MsgBox MsgStr, , "IO统计"

'  End Sub
          
          
          
          
          
          
    MsgBox "AI               点：" & ain & "" & Chr(13) & "RTD            点：" & rtdn & "" & Chr(13) & "AO       阀门点：" & aon1 & "" & Chr(13) & "AO       设备点：" & aon2 & "" & Chr(13) & "DI        现场点：" & din1 & "" & Chr(13) & "DI        设备点：" & din2 & "" & Chr(13) & "DI      辅操台点：" & din3 & "" & Chr(13) & "DO       阀门点：" & don1 & "" & Chr(13) & "DO       设备点：" & don2 & ""
           
   MsgBox "RTD    总数：" & rtdn & "" & Chr(13) & "AI    总数：" & ain & "" & Chr(13) & "AO  总数：" & aon & "" & Chr(13) & "DI    总数：" & din & "" & Chr(13) & "DO  总数：" & don & "" & Chr(13) & "IO   点数总计：" & iozs & ""
         
           
End Sub



Private Sub 格式整理()
        Application.ScreenUpdating = False
        '格式整理
        Selection.Borders(xlDiagonalDown).LineStyle = xlNone
        Selection.Borders(xlDiagonalUp).LineStyle = xlNone
        With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
        End With
        ' 行高 宏
        Selection.RowHeight = 22
        '字体设置
        With Selection.Font
        .Name = "宋体"
        .Size = 9
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .ThemeFont = xlThemeFontNone
        End With
        ' 居中
        With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
        End With
        With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
        End With
        '自动列宽
        Selection.Columns.AutoFit
End Sub

Private Sub 首行格式()
        Application.ScreenUpdating = False
        With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent6
        .TintAndShade = 0.399975585192419
        .PatternTintAndShade = 0
        End With
        Selection.Font.Bold = True
        With ActiveWindow
        .SplitColumn = 0
        .SplitRow = 1
        End With
        ActiveWindow.FreezePanes = True
End Sub

Sub 表格汇总()
        Dim NewName6 As String
        Sheets(1).Name = "汇总表"
        Dim j9, yl, i, a2, ll, kk, fl, kh, kh2, fl2, dh, lh, a3, lh2, ke As Integer
        Dim arr() As Variant
        yl = 1
        fl = 0
        j9 = 2
        i = 1
        ll = 0
        a2 = 2
        dh = 1
        kk = 0
nei2:
        Sheets(2).Activate
        ke = 0
nei:
        Do
            kk = kk + 1
            If ActiveSheet.Cells(1, kk).Text = "位号" And fl = 1 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "数量" And fl = 2 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "用途" And fl = 3 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "温度" And fl = 4 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "压力" And fl = 5 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "量程" And fl = 6 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "PID号" And fl = 7 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "仪表类型" And fl = 8 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "防爆等级" And fl = 9 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "数据表页号" And fl = 10 Then
                ke = 1
                yl = kk
                ElseIf ActiveSheet.Cells(1, kk).Text = "序号" And fl = 11 Then
                ke = 1
                yl = kk
            End If
        Loop Until ActiveSheet.Cells(1, kk).Text = ""
            kk = 0
            
        If fl = 0 Then
            GoTo nx
        End If
        'If ActiveSheet.Name = "调节阀" And fl = 6 Then
           ' GoTo nx
           ' ElseIf ActiveSheet.Name = "音叉" And fl = 6 Then
           ' GoTo nx
           ' ElseIf ActiveSheet.Name = "分析仪" And fl = 6 Then
           ' GoTo nx
            
       ' End If
       

       
       Do
        If ke = 1 Then
        
            Sheets(1).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        End If
        
            If fl = 11 Then   '生成第11列序号
                Sheets(1).Cells(a2, 11).Value = a2 - 1
            End If
            j9 = j9 + 1
            a2 = a2 + 1
        Loop Until ActiveSheet.Cells(j9, 1).Text = "总数量"
        j9 = 2
        ke = 0
        If ActiveSheet.Index <> Worksheets.Count Then
            ActiveSheet.Next.Activate
            GoTo nei
        End If
            a3 = a2
nx:
            ke = 0
            a2 = 2
            fl = fl + 1
            j9 = 2
        If fl < 12 Then
            GoTo nei2
        End If
        Sheets(1).Activate
        arr = Array("位号", "数量", "用途", "温度", "压力", "量程", "PID号", "仪表类型", "防爆等级", "数据表页号", "序号")
        Range(Cells(1, 1), Cells(1, 11)) = arr
        'Sheets(1).Cells(a3, 1).Value = "总数量"
       ' Sheets(1).Cells(a3, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(a3, 2)))
        Range(Cells(1, 1), Cells(a3 - 1, 11)).Select
        Call 格式整理
        Range(Cells(1, 1), Cells(a3, 11)).Select
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 11)).Select
        Call 首行格式
endd:

Erase arr
End Sub

Sub 索引表生成()
        Dim suu, indel As String
        Application.ScreenUpdating = False
        If Not ActiveSheet.Cells(37, 44).Text Like "*索引*" Then
            MsgBox "确认是否为仪表索引表格"
            GoTo endd
        End If
        
         Dim ioh, iol As Integer
        
     ' ioh = ActiveSheet.UsedRange.Row + ActiveSheet.UsedRange.Rows.Count - 1
     
     ioh = ActiveSheet.UsedRange.Rows.Count  '改成这样
     
        
      iol = 42 '当前表总行数
        
       Rows("5:35").ClearContents '删当前表内容
       Rows(iol & ":" & ioh + 1).Delete


       
        suu = InputBox("请输入汇总表工作簿的名称：")
        On Error GoTo endd
        indel = ActiveWorkbook.Name
        On Error GoTo endd
        Dim j9, j7, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, zs, zs2, lh2 As Integer
        'Dim att As String
        Dim arr() As Variant
        dh = 2
        j9 = 2 '汇总表有效行
        a2 = 5 'A3索引表有效行
        fl = 2 'A3索引表有效列
        j7 = 0
        yl = 1 '汇总表有效列
        ll = 1
        i = 0
        zs = 0 '汇总表非空行
        Workbooks(suu & ".xls").Activate
        Do
            zs = zs + 1
        Loop Until Application.WorksheetFunction.CountA(Sheets("汇总表").Rows(zs)) = 0
        '   Loop Until Workbooks(suu & ".xls").Sheets("汇总表").Cells(zs, 1) = "总数量"
        zs2 = zs - 3
        j = zs2 \ 31
        fy = j
        If zs2 Mod 31 = 0 Then
            j = j - 1  '需要复制次数
        End If
        Workbooks(indel).Activate
        Do
            i = i + 1
            lh = ll + 40
            lh2 = lh + 1
            Rows(ll & ":" & lh).Select
            Selection.Copy
            Rows(lh2).Select
            ActiveSheet.Paste
            Do
nei5:
                '     If Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl).Text Like "TE*" Then
                '    j9 = j9 + 1
                '    GoTo NEI5
                '    End If
                j7 = j7 + 1
                Workbooks(indel).ActiveSheet.Cells(a2, fl).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 6).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl + 2).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 16).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl + 7).Text
                '   Sheets(1).Cells(a2, fl + 6).Value = Sheets(2).Cells(j9, yl + 2).Text   '待修改
                a2 = a2 + 1
                j9 = j9 + 1
            Loop Until j7 Mod 31 = 0
            a2 = a2 + 10  '相邻索引表数据间隔
            ll = ll + 41
        Loop Until i = j + 1
        '  ActiveSheet.Rows(a2 - 37) = "总数量"   '总数量文字删除
        For kh = 1 To a2 Step 1
            If ActiveSheet.Cells(kh, 3) = "总数量" Then
                ActiveSheet.Rows(kh) = ""
            End If
        Next
        Rows(ll & ":" & ll + 41).Select
        Selection.Delete
        Rows(1).Select
        ActiveSheet.PageSetup.PrintArea = Range(Cells(1, 1), Cells(ll - 1, 67))
        Do
            Rows((fy * 41) + 1).Select
            ActiveWindow.SelectedSheets.HPageBreaks.Add Before:=ActiveCell
            '   Set ActiveSheet.HPageBreaks(fy).Location = Rows((fy * 40) + 1)
            fy = fy - 1
        Loop While fy > 0
endd:
        Application.ScreenUpdating = True
End Sub

Sub IO表生成()
        Dim suu, indel As String
        If Not ActiveSheet.Cells(4, 11).Text Like "*I/O*" Then
            MsgBox "确认是否为仪表IO表格"
            GoTo endd
        End If
        Application.ScreenUpdating = False
        
      Dim ioh, iol As Integer
        
     ' ioh = ActiveSheet.UsedRange.Row + ActiveSheet.UsedRange.Rows.Count - 1
     
     ioh = ActiveSheet.UsedRange.Rows.Count  '改成这样

        
      iol = 42 '当前表总行数
      
      
        
       Rows("10:36").ClearContents '删当前表内容
       Rows(iol & ":" & ioh + 1).Delete


    
        
        suu = InputBox("请输入汇总表工作簿的名称：")
        On Error GoTo endd
        indel = ActiveWorkbook.Name
        On Error GoTo endd
        Dim j9, j7, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, jx, zs, zs2, lh2, fy As Integer
        'Dim att As String
        Dim arr() As Variant
        dh = 2
        j9 = 2
        a2 = 10
        fl = 2
        j7 = 0
        yl = 1
        ll = 1
        jx = 0
        i = 0
        zs = 0
        Workbooks(suu & ".xls").Activate
        Do
            zs = zs + 1
         '   If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
          '      jx = jx + 1
          '  End If
            j9 = j9 + 1
        Loop Until Application.WorksheetFunction.CountA(Sheets("拆分汇总").Rows(zs)) = 0
        j9 = 2
        zs2 = zs - 3  '汇总表有效数据行数
        zs2 = zs2 - jx   '汇总表排除PG后有效数据行数
        j = zs2 \ 27
        fy = j
        If zs2 Mod 27 = 0 Then
            j = j - 1  '需要复制次数
        End If
        Workbooks(indel).Activate
        Do
            i = i + 1
            lh = ll + 40
            lh2 = lh + 1
            Rows(ll & ":" & lh).Select
            Selection.Copy
            Rows(lh2).Select
            ActiveSheet.Paste
                Do
nei5:
                '    If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
                    '    j9 = j9 + 1
                    '    GoTo nei5
                '    End If
                    j7 = j7 + 1
                    Workbooks(indel).ActiveSheet.Cells(a2, fl).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text
                    Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 7).Text
                    ' Workbooks(indel).activesheet.Cells(a2, fl + 10).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 5).Text
                    '   Sheets(1).Cells(a2, fl + 6).Value = Sheets(2).Cells(j9, yl + 2).Text   '待修改
                    If Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PXT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LXT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FXT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TXT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PHT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PHXT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*OT*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*OXT*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        If InStr(Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text, "ia") > 0 Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = ""
                        Workbooks(indel).ActiveSheet.Cells(a2, 20).Value = "有"
                        End If
                        If Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*电磁*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = ""
                       ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "外供24VDC"
                        End If
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*调节阀*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 23).Value = "4~20mA DC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        If InStr(Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text, "ia") > 0 Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 27).Value = "有"
                        End If
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*开关阀*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*切断阀*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*电磁阀*" Then
                      '  ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 23).Value = "常开接点"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*阀位开反馈*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*阀位关反馈*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "常开接点"
                     '   ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*压力开关*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*液位开关*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*温度开关*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "常开接点"
                     '   ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*远程启动*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 23).Value = "常开接点"
                    '    ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*远程停止*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 23).Value = "常闭接点"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*频率调节*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 23).Value = "4~20mA DC"
                          ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*频率显示*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                      '  Workbooks(indel).ActiveSheet.Cells(a2, 27).Value = "有"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*备妥*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*运行信号*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*故障信号*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*设备停止反馈*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "常开接点"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ' Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "配继电器"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*电流信号*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                      '  Workbooks(indel).ActiveSheet.Cells(a2, 20).Value = "有"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*紧急*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "常闭接点"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*复位*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "常开接点"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TE*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "RTD"
                        If InStr(Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text, "ia") > 0 Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                      '  Workbooks(indel).ActiveSheet.Cells(a2, 20).Value = "有"
                        End If
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*磁氧*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "220VAC"
                       ' ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*ORP*" Then
                       ' Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                       ' ' Workbooks(indel).ActiveSheet.Cells(a2, 16).Value = "24VDC"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*浊度*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "220VAC"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*过碱量*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "220VAC"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*水分*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "220VAC"
                        ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value Like "*红外线*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 12).Value = "4~20mA DC"
                        Workbooks(indel).ActiveSheet.Cells(a2, 30).Value = "220VAC"
                        
                    End If
                    a2 = a2 + 1
                    j9 = j9 + 1
                Loop Until j7 Mod 27 = 0
            a2 = a2 + 14  '相邻IO表上下数据行间隔
            ll = ll + 41
        Loop Until i = j + 1
        For kh = 1 To a2 Step 1
            If ActiveSheet.Cells(kh, 2) = "总数量" Then
              ActiveSheet.Rows(kh) = ""
            End If
        Next
        Rows(ll & ":" & ll + 41).Select
        Selection.Delete
        Rows(1).Select
        ActiveSheet.PageSetup.PrintArea = Range(Cells(1, 1), Cells(ll - 1, 34))
        ActiveWindow.View = xlPageBreakPreview
        Do
            Set ActiveSheet.HPageBreaks(fy).Location = Rows((fy * 41) + 1)
            fy = fy - 1
        Loop While fy > 0
        ActiveSheet.PageSetup.PrintArea = "$A$1:$AH$" & ll - 1   '设置打印区域
endd:
        Application.ScreenUpdating = True
End Sub

Sub 监控表生成()
        Dim suu, indel As String
        Application.ScreenUpdating = False
        
         Dim ioh, iol As Integer
        
     ' ioh = ActiveSheet.UsedRange.Row + ActiveSheet.UsedRange.Rows.Count - 1
     
     ioh = ActiveSheet.UsedRange.Rows.Count  '改成这样
     
        
      iol = 42 '当前表总行数
        

        
       If Not ActiveSheet.Cells(37, 44).Text Like "*监控数据*" Then
            MsgBox "确认是否为仪表监控表格"
            GoTo endd
       End If
       
       
              Rows("7:35").ClearContents '删当前表内容
       Rows(iol & ":" & ioh + 1).Delete
        suu = InputBox("请输入拆分汇总工作簿的名称：")
        On Error GoTo endd
        indel = ActiveWorkbook.Name
        On Error GoTo endd
        Dim j9, j7, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, zs, jx, zs2, lh2, fy As Integer
        'Dim att As String
        Dim arr() As Variant
        dh = 2
        j9 = 2
        a2 = 7
        fl = 2
        j7 = 0
        yl = 1
        jx = 0
        ll = 1
        i = 0
        zs = 0
        Workbooks(suu & ".xls").Activate
        Do
            zs = zs + 1
            If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*TG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*FG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
                jx = jx + 1
            End If
            j9 = j9 + 1
        Loop Until Application.WorksheetFunction.CountA(Sheets("拆分汇总").Rows(zs)) = 0
        j9 = 2
        zs2 = zs - 3  '拆分汇总有效数据行数
        zs2 = zs2 - jx   '拆分汇总排除PG后有效数据行数
        j = zs2 \ 29
        fy = j
        If zs2 Mod 29 = 0 Then
            j = j - 1  '需要复制次数
        End If
        Workbooks(indel).Activate
        Do
            i = i + 1
            lh = ll + 40
            lh2 = lh + 1
            Rows(ll & ":" & lh).Select
            Selection.Copy
            Rows(lh2).Select
            ActiveSheet.Paste
            Do
nei5:
                If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*TG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*FG*" Or Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
                    j9 = j9 + 1
                    GoTo nei5
                End If
                j7 = j7 + 1
                Workbooks(indel).ActiveSheet.Cells(a2, fl).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 1).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 2).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 11).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 5).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 21).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 13).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 23).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 14).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 25).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 15).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 27).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 16).Text
                If Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PXI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LXI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TXI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PHI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*OI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*AI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*AXI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*II*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "4~20mA DC"
                   
                    'Workbooks(indel).ActiveSheet.Cells(a2, 51).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 53).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 58).Value = "√"
                    'Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FI*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FXI*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "4~20mA DC"
                     
                    'Workbooks(indel).ActiveSheet.Cells(a2, 51).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 53).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 55).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 58).Value = "√"
                    'Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
             
                  
                  
                  
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TXV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*PXV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*FXV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*LXV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*AV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*AXV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*VFD*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 48).Value = "4~20mA DC"
                    
                    Workbooks(indel).ActiveSheet.Cells(a2, 53).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 58).Value = "√"
                    'Workbooks(indel).ActiveSheet.Cells(a2, 59).Value = "√"
                    'Workbooks(indel).ActiveSheet.Cells(a2, 61).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*TI*" Then
                    
                                        'Workbooks(indel).ActiveSheet.Cells(a2, 51).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 53).Value = "√"
                    Workbooks(indel).ActiveSheet.Cells(a2, 58).Value = "√"
                    'Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    
                                           If InStr(Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text, "ia") > 0 Then
                                           Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "4~20mA DC"
                                           
                                           
                                           
                                           Else
                                           
                                                                If InStr(Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text, "TE-") > 0 Then
                                                                Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "RTD"
                                                                Else
                                                                Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "4~20mA DC"
                                                                End If
                                                                
                                                                
 
                                          End If
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*压力开关*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*液位开关*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*温度开关*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*开关阀*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*切断阀*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*电磁阀*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*XV*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*XXV*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 48).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*阀位开反馈*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*阀位关反馈*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*YST*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 48).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*YSD*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 48).Value = "常闭接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*YL*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*YA*" Or Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*停止反馈*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*紧急停车*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "常闭接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                    ElseIf Workbooks(indel).ActiveSheet.Cells(a2, fl + 4).Value Like "*复位*" Then
                    Workbooks(indel).ActiveSheet.Cells(a2, 45).Value = "常开接点"
                    Workbooks(indel).ActiveSheet.Cells(a2, 60).Value = "√"
                     End If
                    If Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*IC*" Then
                        Workbooks(indel).ActiveSheet.Cells(a2, 35).Value = "√"
                        
                End If
                a2 = a2 + 1
                j9 = j9 + 1
            Loop Until j7 Mod 29 = 0
            a2 = a2 + 12  '相邻索引表数据间隔
            ll = ll + 41
        Loop Until i = j + 1
        '总数量文字删除
        For kh = 1 To a2 Step 1
            If ActiveSheet.Cells(kh, 2) = "总数量" Then
                ActiveSheet.Rows(kh) = ""
            End If
        Next
        Rows(ll & ":" & ll + 41).Select
        Selection.Delete
        Rows(1).Select
        ActiveSheet.PageSetup.PrintArea = Range(Cells(1, 1), Cells(ll - 1, 41))
        ActiveWindow.View = xlPageBreakPreview
        Do
            Set ActiveSheet.HPageBreaks(fy).Location = Rows((fy * 41) + 1)
            fy = fy - 1
        Loop While fy > 0
        ActiveSheet.PageSetup.PrintArea = "$A$1:$BO$" & ll - 1   '设置打印区域
        
endd:
        Application.ScreenUpdating = True
End Sub
Sub 监控表位号()

       If Not ActiveSheet.Name Like "*拆分汇总*" Then
            MsgBox "确认是否为拆分汇总表格"
            Exit Sub
       End If
       

        Dim a, d, b, la, ain, aon, din, don, rtdn, sjy, sj As String
        Dim arr, arr2 As Variant
        Dim c, i, j, hang, lie, lie2, jj, nn As Integer
        c = 0
        i = 0
        j = 14
        hang = 2
        lie = 1
        lie2 = 1
        ain = 0
        aon = 0
        din = 0
        don = 0
        rtdn = 0
jj = 1


Do

lie = lie + 1



Loop Until Application.WorksheetFunction.CountA(Sheets("拆分汇总").Rows(lie)) = 0

lie = lie - 2


'MsgBox lie

For nn = 1 To lie

jj = jj + 1




For i = 1 To 4


If Sheets("拆分汇总").Cells(jj, j).Value <> "" Then



c = c + 1
End If

j = j + 1
Next i


j = 14



If Sheets("拆分汇总").Cells(jj, 12).Value = "" Then

                If c > 0 Then
                
                sj = "A"
                                             
                                            If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                          
                                                          
                                                             ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                          
                                                          
                                            ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "S-") > 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-"), sj & "-")
                                            
                                                         
                                            Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If
                                            
                
                Else
               '  Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
               sj = ""
               
                                                              If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                          
                                                             ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                          
                                            ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "S-") > 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-"), "S" & sj & "-")
                                            
                                                         
                                            Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If
                 
                 End If
 
 
 Else
                If Sheets("拆分汇总").Cells(jj, 18).Value = "" Then
                
                        If c > 0 Then
                        
                        
                        
                        sj = "CA"
                        
                                                                    If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                                                   
                                                                                   
                                                                                                                                                     ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                                                   
                                                                                   
                                                                     Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If

                        Else
                        
                        sj = "C"
                        
                        
                                                                    If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                                                   
                                                                                                                                                      ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                                                   
                                                                      Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If

                        End If
                        
                Else
                
                       If c > 0 Then
                       
                       
                       sj = "SA"
                       
                                                                   If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                                                   
                                                                                           ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                                                   
                                                                                   
                                                                    ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "S-") > 0 Then
                                                                                      Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-")
                                                                                      Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-"), sj & "-")
                                                                        
                                                         
                                            Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If

                       Else
                       
                       sj = "S"
                                                                   If InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "T-") > 0 And InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "YST-") = 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "T-"), "I" & sj & "-")
                                                                                   
                                                                                    ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "E-") > 0 Then
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-")
                                                                                   Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "E-"), "I" & sj & "-")
                                                                                   
                                                                                   
                                                                                                               ElseIf InStr(Sheets("拆分汇总").Cells(jj, 1).Value, "S-") > 0 Then
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-")
                                                          Sheets("拆分汇总").Cells(jj, 2).Value = Join(Split(Sheets("拆分汇总").Cells(jj, 1).Value, "S-"), sj & "-")
                                            
                                                         
                                            Else
                                            
                                            Sheets("拆分汇总").Cells(jj, 2).Value = Sheets("拆分汇总").Cells(jj, 1).Value
                                            End If

                       
                       End If
                       
                       
                       
                End If
                
                
End If





                        
                        


c = 0


'MsgBox sj

Next











    Columns("B:B").Select
    Selection.Columns.AutoFit
End Sub
Sub 设计阶段()
Dim lh, a2, fl, fl2, i, sdn As Integer
Dim gcm As String

On Error GoTo endd
gcm = InputBox("输入设计阶段")



        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
                    a2 = 6
                    fl = 26
                  
                    i = 50    '数据表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(3, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(3, 11).Value Like "*材料表*" Then
                    a2 = 6
                    fl = 26
                 
                    i = 41    '表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电    缆    表  *" Then
                    a2 = 39
                    fl = 59
             
                    i = 41   '监控表行数
doo:
                    Do
                       
                        Sheets(sdn).Cells(a2, fl).Value = gcm
                     
                        
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
        MsgBox "检查表格格式"
        Exit Sub
            End If
        Next sdn
       
endd:
End Sub

Sub 项目编号()
Dim lh, a2, fl, fl2, i, sdn As Integer
Dim gcm As String

On Error GoTo endd
gcm = InputBox("输入项目编号")



        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
                    a2 = 6
                    fl = 14
                  
                    i = 50    '数据表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(3, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(3, 11).Value Like "*材料表*" Then
                    a2 = 6
                    fl = 14
                 
                    i = 41    '表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电    缆    表  *" Then
                    a2 = 39
                    fl = 47
             
                    i = 41   '监控表行数
doo:
                    Do
                       
                        Sheets(sdn).Cells(a2, fl).Value = gcm
                     
                        
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
        MsgBox "检查表格格式"
        Exit Sub
            End If
        Next sdn
       
endd:
End Sub

Sub 工程名称()
Dim lh, a2, fl, fl2, i, sdn As Integer
Dim gcm As String

On Error GoTo endd
gcm = InputBox("输入工程名称")



        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
                    a2 = 3
                    fl = 27
                  
                    i = 50    '数据表行数
                    GoTo doo
                    
            ElseIf Sheets(sdn).Cells(3, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(3, 11).Value Like "*材料表*" Then
                    a2 = 3
                    fl = 27
                 
                    i = 41    '表行数
                    GoTo doo
                    
                    
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电    缆    表  *" Then
                    a2 = 36
                    fl = 60
             
                    i = 41   '监控表行数
doo:
                    Do
                       
                        Sheets(sdn).Cells(a2, fl).Value = gcm
                     
                        
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
        MsgBox "检查表格格式"
        Exit Sub
            End If
        Next sdn
       
endd:
End Sub

Sub 装置工区()
Dim lh, a2, fl, fl2, i, sdn As Integer
Dim gcm As String

On Error GoTo endd
gcm = InputBox("输入装置工区")



        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
                    a2 = 4
                    fl = 27
                  
                    i = 50    '数据表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(3, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(3, 11).Value Like "*材料表*" Then
                    a2 = 4
                    fl = 27
                 
                    i = 41    '表行数
                    GoTo doo
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电    缆    表  *" Then
                    a2 = 37
                    fl = 60
             
                    i = 41   '监控表行数
doo:
                    Do
                       
                        Sheets(sdn).Cells(a2, fl).Value = gcm
                     
                        
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
        MsgBox "检查表格格式"
        Exit Sub
            End If
        Next sdn
       
endd:
End Sub

Sub 数据表图号()
Dim lh, a2, fl, fl2, i, sdn As Integer
Dim gcm As String

On Error GoTo endd
gcm = InputBox("输入数据表图号")



        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
                    a2 = 5
                    fl = 27
                  
                    i = 50    '数据表行数
                    GoTo doo
                    
            ElseIf Sheets(sdn).Cells(3, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(3, 11).Value Like "*材料表*" Then
                    a2 = 5
                    fl = 27
                   
                    i = 41    '表行数
                    GoTo doo
                    
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电    缆    表  *" Then
                    a2 = 38
                    fl = 60
             
                    i = 41   '监控表行数
doo:
                    Do
                       
                        Sheets(sdn).Cells(a2, fl).Value = gcm
                     
                        
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
        MsgBox "检查表格格式"
        Exit Sub
            End If
        Next sdn
       
endd:
End Sub

Sub 数据表索引生成()
        Dim suu, indel As String
        Application.ScreenUpdating = False
        If Not ActiveSheet.Cells(4, 8).Text Like "*索引*" Then
            MsgBox "确认是否为仪表索引表格"
            GoTo endd
        End If
        
         Dim ioh, iol As Integer
        
     ' ioh = ActiveSheet.UsedRange.Row + ActiveSheet.UsedRange.Rows.Count - 1
     
     ioh = ActiveSheet.UsedRange.Rows.Count  '改成这样
     
        
      iol = 50 '当前表总行数
        
       Rows("10:44").ClearContents '删当前表内容
       Rows(iol & ":" & ioh + 1).Delete

        suu = InputBox("请输入汇总表工作簿的名称：")
        On Error GoTo endd
        indel = ActiveWorkbook.Name
        On Error GoTo endd
        Dim j9, j7, n9, yl, i, a2, ll, fl, kh, kh2, dh, lh, zs, zs2, lh2, fl2, nn As Integer
        'Dim att As String
        Dim arr() As Variant
        dh = 2
        j9 = 2
        a2 = 10
        fl2 = 1
        fl = 2
        j7 = 0
        yl = 1
        nn = 0
        ll = 1
        i = 0
        zs = 0
        Workbooks(suu & ".xls").Activate
        Do
            zs = zs + 1
        Loop Until Application.WorksheetFunction.CountA(Sheets("汇总表").Rows(zs)) = 0
        '   Loop Until Workbooks(suu & ".xls").Sheets("汇总表").Cells(zs, 1) = "总数量"
        zs2 = zs - 3
        j = zs2 \ 70
        fy = j
        If zs2 Mod 70 = 0 Then
            j = j - 1  '需要复制次数
        End If
        Workbooks(indel).Activate
        Do
            i = i + 1
            lh = ll + 49
            lh2 = lh + 1
            Rows(ll & ":" & lh).Select
            Selection.Copy
            Rows(lh2).Select
            ActiveSheet.Paste
            Do
nei5:
                '     If Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl).Text Like "TE*" Then
                '    j9 = j9 + 1
                '    GoTo NEI5
                '    End If
                nn = nn + 1
                j7 = j7 + 1
                Workbooks(indel).ActiveSheet.Cells(a2, fl).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl + 6).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl + 9).Text
                Workbooks(indel).ActiveSheet.Cells(a2, fl2).Value = Workbooks(suu & ".xls").Sheets("汇总表").Cells(j9, yl + 10).Text
                '   Sheets(1).Cells(a2, fl + 6).Value = Sheets(2).Cells(j9, yl + 2).Text   '待修改
                a2 = a2 + 1
                j9 = j9 + 1
                If nn Mod 35 = 0 Then
                    a2 = a2 - 35
                    ' MsgBox a2
                    fl = fl + 15
                    fl2 = fl2 + 13
                End If
            Loop Until j7 Mod 70 = 0
            a2 = a2 + 15 + 35 '相邻索引表数据间隔12
            ' MsgBox a2
            ll = ll + 50
            fl = fl - 30
            fl2 = fl2 - 26
        Loop Until i = j + 1
        '  ActiveSheet.Rows(a2 - 37) = ""   '总数量文字删除
        For kh = 1 To a2 Step 1
            If ActiveSheet.Cells(kh, 2) = "总数量" Then
                ' ActiveSheet.Rows(kh) = ""
                ActiveSheet.Cells(kh, 2) = ""
                ElseIf ActiveSheet.Cells(kh, 17) = "总数量" Then
                ActiveSheet.Cells(kh, 17) = ""
            End If
        Next
        Rows(ll & ":" & ll + 50).Select
        Selection.Delete
        Rows(1).Select
        '  ActiveSheet.PageSetup.PrintArea = Range(Cells(1, 1), Cells(ll - 1, 25))
        ActiveSheet.PageSetup.PrintArea = "$A$1:$Y$" & ll - 1   '设置打印区域
        Do
            Rows((fy * 50) + 1).Select
            ActiveWindow.SelectedSheets.HPageBreaks.Add Before:=ActiveCell
            '   Set ActiveSheet.HPageBreaks(fy).Location = Rows((fy * 40) + 1)
            fy = fy - 1
        Loop While fy > 0
endd:
        Application.ScreenUpdating = True
End Sub

Private Sub 温变列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "温变"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 12 Then
            ElseIf n9 > 12 And n9 < 15 Then
            GoTo jixu
            ElseIf n9 > 15 And n9 < 19 Then
            GoTo jixu
            ElseIf n9 = 21 Or n9 = 26 Or n9 = 29 Then
            GoTo jixu
            ElseIf n9 > 36 And n9 < 44 Then
            GoTo jixu
            ElseIf n9 = 44 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 19).Value = ActiveSheet.Cells(num7, 22).Text
                ll = ll + 1
                yl = yl + 6
                a2 = a2 + 1
            If ll Mod 3 = 0 Then
                j9 = j9 + 50
                i = i + 50
                yl = 10
                num7 = num7 + 50
            End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
        For kh2 = kh To 2 Step -1
            If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
            End If
        Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "量程", "输出信号", "防爆等级", "安装形式", "法兰标准及等级", "法兰尺寸及密封面", "接线盒材料", "保护管材料", "套管材料", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "一体化温度变送器"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
End Sub

Private Sub 涡街列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "涡街"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 6
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 8 And n9 < 13 Then
            GoTo jixu
            ElseIf n9 > 13 And n9 < 20 Then
            GoTo jixu
            ElseIf n9 > 24 And n9 < 33 Then
            GoTo jixu
            ElseIf n9 > 34 And n9 < 37 Then
            GoTo jixu
            ElseIf n9 = 43 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
                Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 22).Value = ActiveSheet.Cells(num7, 30).Text
                ll = ll + 1
                yl = yl + 6
                a2 = a2 + 1
            If ll Mod 3 = 0 Then
                j9 = j9 + 50
                i = i + 50
                yl = 14
                num7 = num7 + 50
            End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
        For kh2 = kh To 2 Step -1
            If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
            End If
        Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "最大流量", "正常流量", "最小流量", "量程", "公称通径", "输出信号", "连接形式", "法兰标准", "法兰尺寸", "本体材质", "漩涡发生材质", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "涡街流量计"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub

Private Sub 雷达列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "雷达"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 24 And n9 < 30 Then
            GoTo jixu
            ElseIf n9 = 44 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 14).Value = ActiveSheet.Cells(num7, 22).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
            If ll Mod 3 = 0 Then
                j9 = j9 + 50
                i = i + 50
                yl = 10
                num7 = num7 + 50
            End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
        For kh2 = kh To 2 Step -1
            If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
            End If
        Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "量程", "探头材质", "精度", "输出信号", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "雷达液(料位)位计"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub

Private Sub 音叉列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "音叉"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 22 And n9 < 26 Then
            GoTo jixu
            ElseIf n9 > 26 And n9 < 28 Then
            GoTo jixu
            ElseIf n9 > 31 And n9 < 34 Then
            GoTo jixu
            ElseIf n9 = 44 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 15).Value = ActiveSheet.Cells(num7, 22).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
            If ll Mod 3 = 0 Then
                j9 = j9 + 50
                i = i + 50
                yl = 10
                num7 = num7 + 50
            End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
        For kh2 = kh To 2 Step -1
            If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
            End If
        Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "法兰标准", "工艺接口", "探头材质", "输出信号", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "音叉液位开关"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub
Private Sub 浮球列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "浮球"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 22 And n9 < 26 Then
            GoTo jixu
            ElseIf n9 > 26 And n9 < 28 Then
            GoTo jixu
            ElseIf n9 > 31 And n9 < 34 Then
            GoTo jixu
            ElseIf n9 = 44 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 15).Value = ActiveSheet.Cells(num7, 22).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
            If ll Mod 3 = 0 Then
                j9 = j9 + 50
                i = i + 50
                yl = 10
                num7 = num7 + 50
            End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
        For kh2 = kh To 2 Step -1
            If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                dh = dh + 1
                Rows(kh2).Delete
            End If
        Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "法兰标准", "工艺接口", "探头材质", "输出信号", "防爆等级", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "浮球液位开关"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub
Private Sub 投入式静压列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "投入式静压"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        n9 = 8
        yl = 14 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        num7 = 6
        dh = 0 '被删除行数
nei:
            If n9 > 8 And n9 < 13 Then
                GoTo jixu
                ElseIf n9 > 13 And n9 < 18 Then
                GoTo jixu
               
                  ElseIf n9 > 21 And n9 < 26 Then
                GoTo jixu
                ElseIf n9 = 29 Then
                GoTo jixu
               
                ElseIf n9 > 33 And n9 < 37 Then
                GoTo jixu
              
            
                ElseIf n9 > 39 And n9 < 42 Then
                GoTo jixu
                ElseIf n9 = 45 Then
                GoTo ee
                Else: GoTo jia
            End If
jixu:
            Do
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 20).Value = ActiveSheet.Cells(num7, 30).Text
            ll = ll + 1
            yl = yl + 6
            a2 = a2 + 1
                If ll Mod 3 = 0 Then
                    j9 = j9 + 50
                    i = i + 50
                    yl = 14
                    num7 = num7 + 50
                End If
            Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 3
        fl2 = fl + 1
        fl = fl + 1
        num7 = 6
        yl = 14
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "设备位号", "介质", "压力", "温度", "密度", "量程", "精度", "输出信号", "测量元件材质", "防爆等级", "密封膜片材质", "法兰标准及等级", "法兰尺寸及密封面", "杆缆长度", "仪表类型", "数据表页号")
        Range(Cells(2, fl), Cells(lh, fl)) = "投入式静压液位变送器"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        '
        Call 首行格式
        Workbooks(newname).Activate
endd:
Erase arr
End Sub

Private Sub pHORP列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "pHORP"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            GoTo jixu
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 25 And n9 < 29 Then
            GoTo jixu
            ElseIf n9 > 30 And n9 < 33 Then
            GoTo jixu
            ElseIf n9 > 35 And n9 < 38 Then
            GoTo jixu
            ElseIf n9 > 38 And n9 < 43 Then
            GoTo jixu
            ElseIf n9 = 47 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 20).Value = ActiveSheet.Cells(num7, 22).Text
        ll = ll + 1
        yl = yl + 6
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 10
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "介质", "压力", "温度", "测量范围", "输出信号", "温度补偿", "电源", "防爆等级", "测量电极材质", "参比电极形式", "电极护套形式", "护套材质", "工艺接头尺寸", "仪表类型", "数据表页号")
        
       ' If InStr(Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(j9, fl).Text, "PH") > 0 Then
                       '  Workbooks(indel).ActiveSheet.Cells(a2, 19).Value = "pH分析仪"
                       '  End If
      '  If InStr(Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(j9, fl).Text, "ORP") > 0 Then
                      '  Workbooks(indel).ActiveSheet.Cells(a2, 19).Value = "ORP分析仪"
                        ' End If
        Range(Cells(2, fl), Cells(lh, fl)) = "分析仪"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub
Private Sub 水分列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "水分"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            GoTo jixu
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 26 And n9 < 29 Then
            GoTo jixu
            ElseIf n9 > 29 And n9 < 31 Then
            GoTo jixu
            ElseIf n9 > 33 And n9 < 36 Then
            GoTo jixu
            ElseIf n9 = 47 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 14).Value = ActiveSheet.Cells(num7, 22).Text
        ll = ll + 1
        yl = yl + 6
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 10
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "压力", "温度", "介质", "测量范围", "输出信号", "防爆等级", "分析成分", "仪表类型", "数据表页号")
      
        Range(Cells(2, fl), Cells(lh, fl)) = "水分分析仪"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub

Private Sub 磁氧列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "磁氧"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            GoTo jixu
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 26 And n9 < 29 Then
            GoTo jixu
            ElseIf n9 > 29 And n9 < 31 Then
            GoTo jixu
            ElseIf n9 > 33 And n9 < 36 Then
            GoTo jixu
            ElseIf n9 = 47 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 14).Value = ActiveSheet.Cells(num7, 22).Text
        ll = ll + 1
        yl = yl + 6
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 10
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "压力", "温度", "介质", "测量范围", "输出信号", "防爆等级", "分析成分", "仪表类型", "数据表页号")
      
        Range(Cells(2, fl), Cells(lh, fl)) = "磁氧分析仪"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:

Erase arr
End Sub

Private Sub 红外线列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "红外线"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 14 Then
            GoTo jixu
            ElseIf n9 > 14 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 26 And n9 < 29 Then
            GoTo jixu
            ElseIf n9 > 29 And n9 < 31 Then
            GoTo jixu
            ElseIf n9 > 33 And n9 < 36 Then
            GoTo jixu
            ElseIf n9 = 47 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 14).Value = ActiveSheet.Cells(num7, 22).Text
        ll = ll + 1
        yl = yl + 6
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 10
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "PID号", "管道编号", "压力", "温度", "介质", "测量范围", "输出信号", "防爆等级", "分析成分", "仪表类型", "数据表页号")
      
        Range(Cells(2, fl), Cells(lh, fl)) = "红外线气体分析仪"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub

Private Sub 报警器列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "报警器"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, lh2, num7 As Integer
        Dim arr() As Variant
        num7 = 7
        n9 = 9
        yl = 10 '数据源列
        fl = 1  '新表列
        j9 = n9  '数据源行
        i = 1   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        dh = 0 '被删除行数
nei:
        If n9 > 9 And n9 < 13 Then
            GoTo jixu
            ElseIf n9 > 16 And n9 < 18 Then
            GoTo jixu
            ElseIf n9 > 20 And n9 < 22 Then
            GoTo jixu
            ElseIf n9 > 29 And n9 < 33 Then
            GoTo jixu
            ElseIf n9 = 47 Then
            GoTo ee
            Else: GoTo jia
        End If
jixu:
        Do
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 10).Value = ActiveSheet.Cells(num7, 22).Text
        ll = ll + 1
        yl = yl + 6
        a2 = a2 + 1
        If ll Mod 3 = 0 Then
        j9 = j9 + 50
        i = i + 50
        yl = 10
        num7 = num7 + 50
        End If
        Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0
        j9 = n9
        kh = a2
        i = 1
        fl2 = fl + 1
        fl = fl + 1
        num7 = 7
        yl = 10
        ll = 0
        a2 = 2
jia:
        n9 = n9 + 1
        GoTo nei
ee:
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        '空行
            For kh2 = kh To 2 Step -1
                If Application.WorksheetFunction.CountA(Workbooks(newname2 & ".xls").Sheets(NewName6).Range(Cells(kh2, 1), Cells(kh2, 5))) = 0 Then
                    dh = dh + 1
                    Rows(kh2).Delete
                End If
            Next kh2
        lh = kh - dh   '新表最终行数
        lh2 = lh + 1
        arr = Array("位号", "数量", "用途", "检测气体", "里程", "防爆等级", "预报设定值", "报警设定值", "仪表类型", "数据表页号")
      
        Range(Cells(2, fl), Cells(lh, fl)) = "气体报警器"
        Range(Cells(1, 1), Cells(1, fl2 + 1)) = arr
        Range(Cells(1, 1), Cells(lh, fl2 + 1)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 1).Value = "总数量"
        Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(lh2, 2).Value = Application.WorksheetFunction.Sum(Range(Cells(2, 2), Cells(lh, 2)))
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, fl2 + 1)).Select
        Call 首行格式
        Workbooks(newname).Activate '返回数据表文件
endd:
Erase arr
End Sub

Sub 加页()

Dim i, j, k, z As Integer

i = 0
z = ActiveSheet.UsedRange.Columns.Count '已用列数，不包括表格前空列

k = 0
'MsgBox z

Do

k = k + 1



If k > 10000 Then '如果格式错误缩短检索时间
GoTo ifsjb
End If
Loop Until ActiveSheet.Cells(k, 2) Like "*REV*"




Do

i = i + 1


 Loop Until Application.WorksheetFunction.CountA(ActiveSheet.Rows(i * (k + 1) - 1)) = 0



        Rows(1 & ":" & (k + 1)).Select

    Selection.Copy

   Rows((i - 1) * (k + 1) + 1).Select

  ActiveSheet.Paste
   
ActiveSheet.Names.Add "Print_Area", ActiveSheet.Range("A1").Resize(i * (k + 1), z)  '动态打印区域
   
  ' MsgBox z
   
   j = i
   
   ActiveSheet.ResetAllPageBreaks '重置所有水平分页符

Do
            Rows((i * (k + 1)) + 1).Select
            ActiveWindow.SelectedSheets.HPageBreaks.Add Before:=ActiveCell

          i = i - 1
    Loop While i > 0
 
 
    Rows(j * (k + 1)).Select
    
    Exit Sub
    
ifsjb:

MsgBox "检查数据表格式"
End Sub

Sub 多列拆分()
        '
        ' 宏2 宏
        Dim a, d, b, la, sjy  As String
        Dim arr, arr2 As Variant
        Dim c, i, j, hang, lie, lie2, nn, sj, sna, snb As Integer
        
        i = 0
        j = 2
        hang = 2
        lie = 1
        lie2 = 1
      
      snb = 1
      
      
      Do
      
      If Sheets(snb).Name = "汇总表" Then
      
      Sheets(snb).Select
      ifhz = 1
      
      Exit Do
      End If
      
      
      snb = snb + 1
      
      
      Loop Until snb > Sheets.Count
      
      
      If ifhz = 0 Then
      
      MsgBox "未找到“汇总表”"
      
      Exit Sub
      End If
      
     
      

    
 Sheets("汇总表").Select

      
           For sna = Sheets.Count To 1 Step -1
        Debug.Print Sheets(sna).Name
        If Sheets(sna).Name = "拆分汇总" Then
        
            With Sheets(sna).Tab
        .Color = 192
        .TintAndShade = 0
    End With
        
            Sheets(sna).Delete
              If Sheets(sna).Name = "拆分汇总" Then
              
                With Sheets(sna).Tab
        .ColorIndex = xlNone
        .TintAndShade = 0
    End With
              
              Exit Sub
              
              End If
              
              End If
              
              
              
        
    Next
    

    
    Sheets.Add after:=ActiveSheet
  

       ActiveSheet.Name = "拆分汇总"
       
       
     
           sj = Sheets("汇总表").UsedRange.Columns.Count
        
        'MsgBox la
        
        arr = Array("A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "LAST")
        
        arr2 = Array("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "LAST")
        
        'arr = Array("[A-E]")
        
        'MsgBox arr(4)\
        

        

        
        Do

        sjy = Sheets("汇总表").Cells(hang, lie)
       If InStr(sjy, "G-") = 0 Then
       

        If InStr(sjy, "~") > 0 Then
        
        
        a = Split(sjy, "~")(0)
        la = Right(sjy, 1)
        c = Len(a) - 1
        b = Right(a, 1)
        d = Left((a), c)
        
   
        
     
        

            For i = 0 To UBound(arr)
            
                   
       
            
            If arr(i) = b Then
            
            b = arr(i + 1)
            
            'MsgBox b
            
            Sheets("拆分汇总").Cells(j, lie2).Value = d & arr(i)
            
            
            For nn = 2 To sj - 1 Step 1
            
             Sheets("拆分汇总").Cells(j, lie2 + nn).Value = Sheets("汇总表").Cells(hang, lie + nn)
            
            Next nn
            
            j = j + 1
            
 
            
            ElseIf arr2(i) = b Then
            
            b = arr2(i + 1)
            
            
            
            'MsgBox b
            
             Sheets("拆分汇总").Cells(j, lie2).Value = d & arr2(i)
            
             For nn = 2 To sj - 1 Step 1
            
             Sheets("拆分汇总").Cells(j, lie2 + nn).Value = Sheets("汇总表").Cells(hang, lie + nn)
            
            Next nn
            
            j = j + 1
 
            'MsgBox i
            End If
            
            
            
            If arr(i) = la Or arr2(i) = la Then
            
            Exit For
            
            End If
            
            
           
            Next i
                   
          
           
           
           
        '  If lie2 < ActiveSheet.UsedRange.Columns.Count Then
          
        '  lie2 = lie2 + 1
          
       '   GoTo jixu
          
        '  End If
                   
                   
                   
       
            hang = hang + 1
        
        
        
        Else
        
         Sheets("拆分汇总").Cells(j, lie2).Value = sjy
         

         
         
                      For nn = 2 To sj - 1 Step 1
                      
                  '      MsgBox lie
            
            Sheets("拆分汇总").Cells(j, lie2 + nn).Value = Sheets("汇总表").Cells(hang, lie + nn)
            
         
            
            Next nn
         
        j = j + 1
        hang = hang + 1
        
        
        End If
        Else
        
        hang = hang + 1
      
        End If
        'Loop Until sjy = "总数量" Or hang > 1000
        Loop Until Application.WorksheetFunction.CountA(Sheets("汇总表").Rows(hang)) = 0

        arr = Array("位号", "监控位号", "用途", "温度", "压力", "量程", "PID号", "仪表类型", "防爆等级", "数据表页号", "序号", "组外排序（英文）", "组内排序（数字）", "报警（低低）", "报警（低）", "报警（高高）", "报警（高）", "联锁（S）")
        

        Range(Cells(1, 1), Cells(1, 18)) = arr
        
         Range(Cells(1, 1), Cells(j - 1, 18)).Select
       Call 格式整理
        Range(Cells(1, 1), Cells(j - 1, 18)).Select
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 18)).Select
      Call 首行格式
     Application.DisplayAlerts = True
Erase arr
Erase arr2
End Sub
Sub 组内外排序()
Application.ScreenUpdating = False
Dim hang, senu, hangs, ii, sh, e, al, als, n, an, i, f As Integer


Dim sjy, a, b, c, d As String


If ActiveSheet.Name <> "拆分汇总" Then



Exit Sub

End If



n = 0

al = 2





ss:
sjy = ActiveSheet.Cells(al, 12)



If sjy = "" Then



al = al + 1


If al > 1000 Then


Exit Sub

End If


GoTo ss

Else

sjy = ActiveSheet.Cells(al, 12)


als = al

Do

al = al + 1
If sjy = ActiveSheet.Cells(al, 12) Then

n = n + 1

    Rows(al).Select
    Selection.Cut
    Rows(als).Select
   ' Selection.Offset(1).Select
   Selection.Insert Shift:=xlDown
    
    End If

   Loop Until al = 500
   
   
   an = als + n
   
   n = 0
   

   
   If al < 500 Then
   
   
   GoTo ss
   
   End If
   
   
   
 '  MsgBox an
   
 '  MsgBox als
   
   
    Rows(als & ":" & an).Select
    ActiveSheet.Sort.SortFields.Clear
    ActiveSheet.Sort.SortFields.Add Key:=Range(Cells(als, 13), Cells(an, 13)), _
        SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveSheet.Sort
        .SetRange Range(Cells(als, 1), Cells(an, 18))
        .Header = xlGuess
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
   
     
   
   End If
   
   
   al = an + 1
   
   
   For i = 1 To 3
   
   
   GoTo ss
   
   
   
   Next i
   
   

Application.ScreenUpdating = True
End Sub



Sub 开关阀位反馈加行()
Application.ScreenUpdating = False
Dim hang, senu, hangs, ii, sh, e, f As Integer


Dim sjy, a, b, c, d As String

i = 2
e = 0
hang = Selection.Row


senu = Selection.Rows.Count


hangs = hang + senu - 1






For sh = hangs To hang Step -1

sjy = Sheets(2).Cells(sh, 1)


If InStr(sjy, "V-") > 0 Then
                            a = Split(sjy, "V-")
                            b = Join(a, "ZSO-")
                            c = Join(a, "ZSC-")

    
Rows(sh + 1).Select
     For f = 1 To i
e = e + 1
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Next f
                      
       Sheets(2).Cells(sh + 1, 1) = b
       Sheets(2).Cells(sh + 1, 3) = "阀位开反馈"
       Sheets(2).Cells(sh + 1, 8) = "阀位开反馈"
        Sheets(2).Cells(sh + 2, 1) = c
        Sheets(2).Cells(sh + 2, 3) = "阀位关反馈"
        Sheets(2).Cells(sh + 2, 8) = "阀位关反馈"
                 End If
                      
                      
                      Next sh
                      
                     
                      Sheets(2).Range(Cells(hang, 1), Cells(hangs + e, 1)).Select
                      


Application.ScreenUpdating = True
End Sub

Sub 调节阀电磁阀关位反馈加行()
Application.ScreenUpdating = False
Dim hang, senu, hangs, ii, sh, e, f As Integer


Dim sjy, a, b, c, d As String

i = 2
e = 0
hang = Selection.Row


senu = Selection.Rows.Count


hangs = hang + senu - 1






For sh = hangs To hang Step -1

sjy = Sheets(2).Cells(sh, 1)


If InStr(sjy, "V-") > 0 Then
                            a = Split(sjy, "V-")
                            b = Join(a, "N-")
                            c = Join(a, "ZSC-")

    
Rows(sh + 1).Select
     For f = 1 To i
e = e + 1
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Next f
                      
       Sheets(2).Cells(sh + 1, 1) = b
       Sheets(2).Cells(sh + 1, 3) = "电磁阀"
       Sheets(2).Cells(sh + 1, 8) = "电磁阀"
        Sheets(2).Cells(sh + 2, 1) = c
        Sheets(2).Cells(sh + 2, 3) = "阀位关反馈"
        Sheets(2).Cells(sh + 2, 8) = "阀位关反馈"
                 End If
                      
                      
                      Next sh
                      
                     
                      Sheets(2).Range(Cells(hang, 1), Cells(hangs + e, 1)).Select
                      


Application.ScreenUpdating = True
End Sub

Sub 调节阀关位反馈加行()
Application.ScreenUpdating = False
Dim hang, senu, hangs, ii, sh, e, f As Integer


Dim sjy, a, b, c, d As String

i = 1
e = 0
hang = Selection.Row


senu = Selection.Rows.Count


hangs = hang + senu - 1






For sh = hangs To hang Step -1

sjy = Sheets(2).Cells(sh, 1)


If InStr(sjy, "V-") > 0 Then
                            a = Split(sjy, "V-")
                            b = Join(a, "ZSC-")
                           ' c = Join(a, "ZSC-")

    
Rows(sh + 1).Select
     For f = 1 To i
e = e + 1
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Next f
                      
       Sheets(2).Cells(sh + 1, 1) = b
       Sheets(2).Cells(sh + 1, 3) = "阀位关反馈"
       Sheets(2).Cells(sh + 1, 8) = "阀位关反馈"
        
                 End If
     
                      
                      Next sh
                      
                     
                      Sheets(2).Range(Cells(hang, 1), Cells(hangs + e, 1)).Select
                      


Application.ScreenUpdating = True
End Sub



Sub 序号生成()
Dim lh, dn, gn, a2, a3, fl, fl2, i, sdn As Integer
On Error GoTo endd
dn = InputBox("输入开始页码")

For lh = 1 To 2
        For sdn = 1 To Worksheets.Count
            If Sheets(sdn).Cells(3, 11).Value Like "*仪表数据表*" Then
            
                    a2 = 6
                    fl = 30
                    fl2 = 33
                    i = 50    '数据表行数
                    GoTo doo
              
                  
                       
              ElseIf Sheets(sdn).Cells(4, 11).Value Like "*I/O*" Or Sheets(sdn).Cells(4, 11).Value Like "*材料表*" Then
                    a2 = 6
                    fl = 30
                    fl2 = 33
                    i = 41    '表行数
                    GoTo doo
                    
            ElseIf Sheets(sdn).Cells(37, 44).Value Like "*监控*" Or Sheets(sdn).Cells(37, 44).Value Like "*电缆表*" Then
                    a2 = 39
                    fl = 63
                    fl2 = 66
                    i = 41   '监控表行数
doo:
                    Do
                        If lh = 1 Then
                        Sheets(sdn).Cells(a2, fl).Value = dn
                        dn = dn + 1
                        Else
                        Sheets(sdn).Cells(a2, fl2).Value = gn
                        End If
                        a2 = a2 + i
                    Loop Until Application.WorksheetFunction.CountA(Sheets(sdn).Rows(a2)) = 0
            Else
            MsgBox "检查表格格式"
            Exit Sub
            End If
        Next sdn
        gn = dn - 1
Next lh
endd:
End Sub

Sub 调节阀匹配()
                    
                    Dim a, d, b, la, sjy  As String
                    Dim arr As Variant
                    Dim c, i, j, hang, lie, lie2, nn, hang2, nu, szh, szl, sj, sna, snb, kh2 As Integer
                    nu = 0
                    hang = 2
                    hang2 = 1
                    lie = 1
                    lie2 = 1
                    
                      
      snb = 1
      
      
      Do
      
      If Sheets(snb).Name = "汇总表" Then
      
      Sheets(snb).Select
      ifhz = 1
      
      Exit Do
      End If
      
      
      snb = snb + 1
      
      
      Loop Until snb > Sheets.Count
      
      
      If ifhz = 0 Then
      
      MsgBox "未找到“汇总表”"
      
      Exit Sub
      End If
      
     

 
                    
            For sna = Sheets.Count To 1 Step -1
      Debug.Print Sheets(sna).Name
        If Sheets(sna).Name = "调节阀匹配" Then
        
            With Sheets(sna).Tab
        .Color = 192
        .TintAndShade = 0
    End With

        
         Sheets(sna).Tab.Color = 192
         
         
         
          Sheets(sna).Delete
         


         
         
            If Sheets(sna).Name = "调节阀匹配" Then
            
                                                                 With Sheets(sna).Tab
        .ColorIndex = xlNone
        .TintAndShade = 0
    End With
       
            Exit Sub
            End If
        End If
    Next
       


 Application.ScreenUpdating = False
    
           Sheets("汇总表").Select
                     
    Sheets("汇总表").Copy Before:=Sheets(2)
    
 With Sheets(2).Tab
        .ColorIndex = xlNone
        .TintAndShade = 0
    End With
    
    Sheets(2).Name = "调节阀匹配"
    
                    '统计阀门数量
                    sj = Sheets("调节阀匹配").UsedRange.Columns.Count '使用的列数量
                    Do
                        sjy = Sheets("调节阀匹配").Cells(hang, 1)
                        If InStr(sjy, "V-") > 0 Then
                        nu = nu + 1
                        End If
                        hang = hang + 1
                    Loop Until sjy = "总数量" Or hang > 1000
                    
                    
                    
                    If nu = 0 Or sj = 0 Then
                        Exit Sub
                    End If
                    
                    ReDim arr(1 To nu, 1 To sj)
                    hang = 2
                    szh = 1
                    
                    Do
                        sjy = Sheets("调节阀匹配").Cells(hang, 1)
                        If InStr(sjy, "V-") > 0 Then
                            If szh <= nu Then
                                For szl = 1 To sj
                                    arr(szh, szl) = Sheets("调节阀匹配").Cells(hang, szl)
                                    Range(Cells(hang, 1), Cells(hang, sj)).Select
                                    With Selection.Interior
                                    .Pattern = xlSolid
                                    .PatternColorIndex = xlAutomatic
                                    .Color = 65535   '标记阀门行颜色
                                    .TintAndShade = 0
                                    .PatternTintAndShade = 0
                                    End With
                                Next szl
                            End If
                            szh = szh + 1
                        End If
                        hang = hang + 1
                    Loop Until sjy = "总数量" Or hang > 1000
                    
                    '隔行插入空行
                    hang = hang - 1
                    For hang = hang To 2 Step -1
                        Sheets("调节阀匹配").Rows(hang).Select
                        Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
                    Next hang
                    
                    hang = 1
                    szh = 1
                    Do
                        sjy = Sheets("调节阀匹配").Cells(hang, 1)
                        Sheets("调节阀匹配").Activate
                        If InStr(sjy, "T-") > 0 And nu > 0 Then
                            a = Split(sjy, "T-")
                            la = Join(a, "")
                               GoTo TW
                            
                         ElseIf InStr(sjy, "E-") > 0 And nu > 0 Then
                            a = Split(sjy, "E-")
                            la = Join(a, "")
                            
                            
TW:
                            
                            Do
                                sa = Split(arr(szh, 1), "V-")
                                sb = Join(sa, "")
                                If la = sb Then
                                    Sheets("调节阀匹配").Cells(hang + 1, 1).Resize(1, sj) = WorksheetFunction.Index(arr, szh, 0)
                                End If
                                szh = szh + 1
                            Loop Until szh > nu
                        End If
                        
                        hang = hang + 1
                        szh = 1
                    Loop Until sjy = "总数量" Or hang > 1000
                    
                    '删除空行
                    For kh2 = hang To 2 Step -1
                        If Application.WorksheetFunction.CountA(Sheets("调节阀匹配").Range(Cells(kh2, 1), Cells(kh2, sj))) = 0 Then
                            Rows(kh2).Delete
                        End If
                    Next kh2
                    '删除重复行
                    Dim ii As Long
                    For ii = Range("A8888").End(xlUp).Row To 2 Step -1
                        If WorksheetFunction.CountIf(Range("A2:A" & ii), Cells(ii, 1)) > 1 And Range(Cells(ii, 1), Cells(ii, 10)).Interior.Color = 65535 Then
                            Cells(ii, 1).EntireRow.Delete
                        End If
                    Next
                    Application.ScreenUpdating = True
                    Erase arr
                    End Sub
Sub 电缆表生成()

Application.ScreenUpdating = False

        Dim suu, indel As String
        If Not ActiveSheet.Cells(37, 44).Text Like "电    缆    表  " Then
            MsgBox "确认是否为电缆表"
            GoTo endd
        End If
        Application.ScreenUpdating = False
        
      Dim ioh, iol, ilx, jlx As Integer
        
     ' ioh = ActiveSheet.UsedRange.Row + ActiveSheet.UsedRange.Rows.Count - 1
     
     ioh = ActiveSheet.UsedRange.Rows.Count  '改成这样
     
        
      iol = 42 '当前表总行数
      
      
        
       Rows("7:35").ClearContents '删当前表内容
       Rows(iol & ":" & ioh + 1).Delete


    
        
        suu = InputBox("请输入汇总表工作簿的名称：")
        On Error GoTo endd
        indel = ActiveWorkbook.Name
        On Error GoTo endd
        Dim j9, j7, n9, yl, i, a2, ll, fl, kh, kh2, fl2, dh, lh, jx, zs, zs2, lh2, fy As Integer
        
 
        
        'Dim att As String
        Dim arr() As Variant
        dh = 2
        j9 = 2
        a2 = 7
        fl = 31
        j7 = 0
        yl = 1
        ll = 1
        jx = 0
        ilx = 1
        jlx = 35
        
        i = 0
        zs = 0
        Workbooks(suu & ".xls").Activate
        Do
            zs = zs + 1
            If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
                jx = jx + 1
            End If
            j9 = j9 + 1
        Loop Until Application.WorksheetFunction.CountA(Sheets("拆分汇总").Rows(zs)) = 0
        j9 = 2
        zs2 = zs - 3  '汇总表有效数据行数
        zs2 = zs2 - jx   '汇总表排除PG后有效数据行数
        j = zs2 \ 29
        fy = j
        If zs2 Mod 29 = 0 Then
            j = j - 1  '需要复制次数
        End If
        Workbooks(indel).Activate
        Do
            i = i + 1
            lh = ll + 40
            lh2 = lh + 1
            Rows(ll & ":" & lh).Select
            Selection.Copy
            Rows(lh2).Select
            ActiveSheet.Paste
                Do
nei5:
                    If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text Like "*PP-*" Then
                        j9 = j9 + 1
                        GoTo nei5
                    End If
                    j7 = j7 + 1
                    Workbooks(indel).ActiveSheet.Cells(a2, fl).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl).Text
                   ' Workbooks(indel).ActiveSheet.Cells(a2, fl + 5).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 7).Text
                    ' Workbooks(indel).activesheet.Cells(a2, fl + 10).Value = Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 5).Text
                    '   Sheets(1).Cells(a2, fl + 6).Value = Sheets(2).Cells(j9, yl + 2).Text   '待修改
                    
                    
                    If Workbooks(indel).ActiveSheet.Cells(a2, fl).Value Like "*T-*" Then
                      If Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text Like "*ia*" Then
                    
                    Workbooks(indel).ActiveSheet.Cells(a2, 35).Value = "ZR-ia-DJYPVP"
                   
                   
                    
                     ElseIf Workbooks(suu & ".xls").Sheets("拆分汇总").Cells(j9, yl + 8).Text Like "*d*" Then
                    
                     Workbooks(indel).ActiveSheet.Cells(a2, 35).Value = "ZR-DJYPVP"
                      
                      
                     Else
                    
                     Workbooks(indel).ActiveSheet.Cells(a2, 35).Value = "DJYPVP"
                       
                    End If
                     Workbooks(indel).ActiveSheet.Cells(a2, 40).Value = "1*2*1.5"
                       Workbooks(indel).ActiveSheet.Cells(a2, 56).Value = "DN20"
                        Workbooks(indel).ActiveSheet.Cells(a2, 59).Value = "10"
                        
                        End If
         
                    a2 = a2 + 1
                    j9 = j9 + 1
                Loop Until j7 Mod 29 = 0
            a2 = a2 + 12  '相邻IO表上下数据行间隔
            ll = ll + 41
        Loop Until i = j + 1
        For kh = 1 To a2 Step 1
            If ActiveSheet.Cells(kh, 2) = "总数量" Then
              ActiveSheet.Rows(kh) = ""
            End If
        Next
        Rows(ll & ":" & ll + 41).Select
        Selection.Delete
        Rows(1).Select
        ActiveSheet.PageSetup.PrintArea = Range(Cells(1, 1), Cells(ll - 1, 34))
        ActiveWindow.View = xlPageBreakPreview
        Do
            Set ActiveSheet.HPageBreaks(fy).Location = Rows((fy * 41) + 1)
            fy = fy - 1
        Loop While fy > 0
        ActiveSheet.PageSetup.PrintArea = "$A$1:$BO$" & ll - 1   '设置打印区域

Do
        
        If ActiveSheet.Cells(ilx, 31).Value Like "*ZSO*" Then

If ActiveSheet.Cells(ilx + 1, 31).Value Like "*ZSC*" Then

ActiveSheet.Range(Cells(ilx, jlx), Cells(ilx + 1, jlx + 4)).Select
Call 合并单元格

ActiveSheet.Range(Cells(ilx, jlx + 5), Cells(ilx + 1, jlx + 8)).Select
Call 合并单元格

ActiveSheet.Range(Cells(ilx, jlx + 21), Cells(ilx + 1, jlx + 23)).Select
Call 合并单元格

ActiveSheet.Range(Cells(ilx, jlx + 24), Cells(ilx + 1, jlx + 26)).Select
Call 合并单元格




End If


End If


        ilx = ilx + 1
        
        Loop Until ilx = ll
        
        
        
        
endd:
        Application.ScreenUpdating = True
End Sub



Sub 电缆统计()

Application.ScreenUpdating = False

Dim zria, zrd, djy As Long

Dim i, j, a, b, c As Integer

i = 1
djy = 0
zrd = 0
zria = 0


j = 35

'MsgBox ActiveSheet.UsedRange.Rows.Count



Do





If ActiveSheet.Cells(i, 44).Value <> "" Then
If ActiveSheet.Cells(i, j) = "DJYPVP" Then

djy = djy + ActiveSheet.Cells(i, 44).Value




ElseIf ActiveSheet.Cells(i, j) = "ZR-DJYPVP" Then

zrd = zrd + ActiveSheet.Cells(i, 44).Value

ElseIf ActiveSheet.Cells(i, j) = "ZR-ia-DJYPVP" Then

zria = zria + ActiveSheet.Cells(i, 44).Value

End If
End If
i = i + 1


Loop Until i > ActiveSheet.UsedRange.Rows.Count


MsgBox "DJYPVP电缆数量：" & djy & "米" & Chr(13) & "ZR-DJYPVP电缆数量：" & zrd & "米" & Chr(13) & "ZR-ia-DJYPVP电缆数量：" & zria & "米"

Application.ScreenUpdating = True

End Sub



Sub 合并单元格()
     Application.DisplayAlerts = False

    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = True
    End With
     Application.DisplayAlerts = True
End Sub



Private Sub 隔膜压力表列表()
        Application.ScreenUpdating = False
        Dim NewName6 As String
        NewName6 = "隔膜压力表"
        Workbooks(newname2 & ".xls").Sheets.Add.Name = NewName6
        Dim j9, n9, yl, i, a2, ll, tt, j10, ss, zz, fl, kh, kh2, fl2, dh, lh, lh2, num7, emp As Integer
        'Dim att As String
        Dim arr() As Variant
        yl = 2 '数据源列
        tt = 0
        j9 = 11  '数据源行
        i = 3   '数据源非空行
        ll = 0  '单个数据表页中包含几列仪表
        a2 = 2  '新表行
        fl = 1  '新表列
        emp = 0
        dh = 0 '被删除行数
        num7 = 6
        j10 = 31
        j14 = 32
        j15 = 37
        j11 = 38
        j12 = 39
        j13 = 40
nei:
        Do
            If Application.WorksheetFunction.CountA(ActiveSheet.Rows(j9)) = 0 Then
                GoTo nei2
            End If
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, fl).Value = ActiveSheet.Cells(j9, yl).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 8).Value = ActiveSheet.Cells(j10, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 9).Value = ActiveSheet.Cells(j14, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 10).Value = ActiveSheet.Cells(j15, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 11).Value = ActiveSheet.Cells(j11, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 12).Value = ActiveSheet.Cells(j12, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 13).Value = ActiveSheet.Cells(j13, 15).Text
            Workbooks(newname2 & ".xls").Sheets(NewName6).Cells(a2, 15).Value = ActiveSheet.Cells(num7, 30).Text
            a2 = a2 + 1
nei2:
            j9 = j9 + 1
            tt = tt + 1
        Loop Until tt Mod 15 = 0
        j15 = j15 + 50
        j14 = j14 + 50
        j13 = j13 + 50
        j12 = j12 + 50
        j11 = j11 + 50
        j10 = j10 + 50
        j9 = j9 + 35
        i = i + 50
        num7 = num7 + 50
        If Application.WorksheetFunction.CountA(ActiveSheet.Rows(i)) = 0 Then
        Do
            yl = yl + 1
                If yl = 6 Or yl = 9 Or yl = 12 Or yl = 21 Or yl = 25 Then
                    j9 = 11
                    j10 = 31
                    j11 = 38
                    j12 = 39
                    j13 = 40
                    j14 = 32
                    j15 = 37
                    n9 = a2
                    fl = fl + 1
                    i = 3
                    num7 = 6
                    a2 = 2
                    GoTo nei
                End If
        Loop Until yl = 27
        Else: GoTo nei
        End If
        Workbooks(newname2 & ".xls").Sheets(NewName6).Activate
        ActiveSheet.Cells(a2, 1) = "总数量"
        arr = Array("位号", "介质", "温度", "压力", "量程", "PID号", "用途", "隔膜材料", "表壳材质", "螺纹规格", "法兰标准及等级", "法兰尺寸及密封面", "数量", "仪表类型", "数据表页号")
        Range(Cells(2, 14), Cells(n9 - 1, 14)) = "隔膜压力表"
        Range(Cells(1, 1), Cells(1, 15)) = arr
        Range(Cells(1, 1), Cells(a2 - 1, 15)).Select
        Call 格式整理
        '自动列宽
        Selection.Columns.AutoFit
        ' 加粗冻结 宏
        Range(Cells(1, 1), Cells(1, 15)).Select
        Call 首行格式
        Workbooks(newname).Activate   'fan hui shu ju biao
endd:
End Sub


Sub 删除内容()
Dim pic As Shape
Dim a, b, c As Integer
b = ActiveSheet.UsedRange.Rows.Count
a = ActiveCell.Row

c = MsgBox("确认删除所选行之后所有内容吗？", vbOKCancel)


If c = 2 Then

Exit Sub

End If


For Each pic In ActiveSheet.Shapes

If pic.Top >= Rows(a).Top Then

pic.Delete


End If

Next

If a <= b Then

Rows(a & ":" & b).Select
Rows(a & ":" & b).Delete
Else
Exit Sub
End If

End Sub



Sub 电机信号处理()
Application.ScreenUpdating = False
Dim hang, senu, hangs, ii, sh, e, f, djxh, djn, gg, tt, nn As Integer


If ActiveSheet.Name = "拆分汇总" Then
If UserForm1.Visible = False Then


UserForm1.Show
End If

Else

MsgBox "不是拆分汇总表格"


Exit Sub



End If

Dim arr() As Variant
Dim arr2() As Variant
Dim arr3() As Variant

Dim sjy, a, b, c, d As String
nn = 0
djxh = 0

For djn = 9 To 2 Step -1
ReDim Preserve arr(nn)
ReDim Preserve arr2(nn)
ReDim Preserve arr3(nn)
If UserForm1.Controls("checkbox" & djn) = True Then


arr(nn) = djn

If djn = 2 Then

arr2(nn) = "运行信号"
arr3(nn) = "YL-"
ElseIf djn = 3 Then
arr2(nn) = "故障信号"
arr3(nn) = "YA-"
ElseIf djn = 4 Then
arr2(nn) = "备妥信号"
arr3(nn) = "YEP-"
ElseIf djn = 5 Then
arr2(nn) = "电流信号"
arr3(nn) = "YI-"
ElseIf djn = 6 Then
arr2(nn) = "远程启动"
arr3(nn) = "YST-"
ElseIf djn = 7 Then
arr2(nn) = "远程停止"
arr3(nn) = "YSD-"
ElseIf djn = 8 Then
arr2(nn) = "频率显示"
arr3(nn) = "YX-"
ElseIf djn = 9 Then
arr2(nn) = "频率调节"
arr3(nn) = "YXC-"

End If







djxh = djxh + 1

nn = nn + 1

End If




Next djn












If djxh = 0 Then
'MsgBox "未选择任何电机信号类型"
Exit Sub
End If

i = djxh
e = 0
hang = Selection.Row


senu = Selection.Rows.Count


hangs = hang + senu - 1



gg = 0
tt = 0

For sh = hangs To hang Step -1

sjy = Sheets("拆分汇总").Cells(sh, 1)


If InStr(sjy, "PP-") > 0 Then
                            a = Split(sjy, "PP-")
                            
                   b = Join(a, arr3(gg))
                       
                           ' c = Join(a, "ZSC-")


 gg = gg + 1

Rows(sh + 1).Select
     For f = 1 To i
e = e + 1
 Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    
    
    
    
    
                      
       Sheets("拆分汇总").Cells(sh + gg, 1) = Join(a, arr3(tt))
       Sheets("拆分汇总").Cells(sh + gg, 8) = arr2(tt)
    '   Sheets("拆分汇总").Cells(sh + 1, 8) = "设备运行反馈"
 tt = tt + 1
       Next f
      
         End If
     
                      
                      Next sh
                      
                     
                  '    Sheets("拆分汇总").Range(Cells(hang, 1), Cells(hangs + e, 1)).Select
                       Sheets("拆分汇总").Rows(hangs + e + 1).Select
                       ActiveWindow.SmallScroll Down:=djxh         '自动上滚
                       
Erase arr
Erase arr2
Erase arr3


Application.ScreenUpdating = True
End Sub

Sub 计算器()
'
' 宏1 宏
'

'
   
Application.ActivateMicrosoftApp 0
End Sub

